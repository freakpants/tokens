<!doctype html>
<html>

<head>
  <title>Futties Collector</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="jQuery.print.min.js"></script>
  <link rel="stylesheet" href="css.css">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Secular+One">
</head>

<body>
  <div id="overlay_bg"></div>
  <div class="futties-header">
    <div id="show_legend" class='token_number_legend'>?</div>
    <h1>FUT22 Collector</h1>
    <div id="futties_counters">
      <h3>Collected: <span id="collected">0/429</span></h3>
      <h3>Displaying: <span id="displaying">200/429</span></h3>
    </div>
    <div id="search">
      <input type="text" placeholder="..player name (lowercase)">
    </div>
    <button id="futties_reset" class="reset btn-standard call-to-action">
      <span class="button__text">Reset Collection</span>
    </button>
    <button class="unclaim btn-standard call-to-action">
      <span class="button__text">Uncollect</span>
    </button>
    <button class="print btn-standard call-to-action">
      <span class="button__text">Print</span>
    </button>
    <div id="batch_wrapper">
      <select id="batch_select">
        <option selected value="preseason_2">Preseason 2 (5)</option>
        <option value="futties_123">Futties 1-3 PP</option>
        <option value="campaign">Campaign Bag PP (6)</option>
        <option value="preseason_1">Preseason 1 (4)</option>
        <option value="futties_3">Futties 3 (3)</option>
        <option value="futties_2">Futties 2 (2)</option>
        <option value="futties_1">Futties 1 (1)</option>
      </select>


    </div>
    <div id="checkbox_wrapper" class="checkbox_wrapper_futties">
      <div>
        <input type="checkbox" id="toggleall" name="toggleall" checked>
        <label for="toggleall">Toggle All</label>
      </div>
      <div>
        <input type="checkbox" id="shapeshifters" name="shapeshifters" checked>
        <label for="shapeshifters">Shapeshifters</label>
      </div>
      <div>
        <input type="checkbox" id="toty" name="toty" checked>
        <label for="toty">TOTY</label>
      </div>
      <div>
        <input type="checkbox" id="tots" name="tots" checked>
        <label for="tots">TOTS</label>
      </div>
      <div>
        <input type="checkbox" id="uefa" name="uefa" checked>
        <label for="uefa">UEFA Leagues</label>
      </div>
      <div>
        <input type="checkbox" id="fantasy" name="fantasy" checked>
        <label for="fantasy">FUT Fantasy</label>
      </div>
      <div>
        <input type="checkbox" id="headliners" name="headliners" checked>
        <label for="headliners">Headliners</label>
      </div>
      <div>
        <input type="checkbox" id="captains" name="captains" checked>
        <label for="captains">FUT Captains</label>
      </div>
      <div>
        <input type="checkbox" id="promo" name="promo" checked>
        <label for="promo">TOTGS</label>
      </div>
      <div>
        <input type="checkbox" id="futurestars" name="futurestars" checked>
        <label for="futurestars">Future Stars</label>
      </div>
      <div>
        <input type="checkbox" id="birthday" name="birthday" checked>
        <label for="birthday">FUT Birthday</label>
      </div>
      <div>
        <input type="checkbox" id="wildcard" name="wildcard" checked>
        <label for="wildcard">Winter Wildcards</label>
      </div>
      <div>
        <input type="checkbox" id="signature" name="signature" checked>
        <label for="signature">Signature Signings</label>
      </div>
      <div>
        <input type="checkbox" id="numbersup" name="numbersup" checked>
        <label for="numbersup">Numbersup</label>
      </div>
      <div>
        <input type="checkbox" id="totw" name="totw" checked>
        <label for="totw">TOTW</label>
      </div>
      <div>
        <input type="checkbox" id="honourable" name="honourable" checked>
        <label for="honourable">TOTY Honour</label>
      </div>
      <div>
        <input type="checkbox" id="libertadores" name="libertadores" checked>
        <label for="libertadores">Libertadores</label>
      </div>
      <div>
        <input type="checkbox" id="halloween" name="halloween" checked>
        <label for="halloween">Rulebreakers</label>
      </div>
      <div>
        <input type="checkbox" id="otw" name="otw" checked>
        <label for="otw">Ones To Watch</label>
      </div>
      <div>
        <input type="checkbox" id="versus" name="versus" checked>
        <label for="versus">FUT Versus</label>
      </div>
      <div>
        <input type="checkbox" id="motm" name="motm" checked>
        <label for="motm">MOTM</label>
      </div>
    </div>
  </div>
  <div id="legend_wrapper">
    The numbers above each card tell you in which batch or player pick the card was/is available. <br>
    <div class="legend_line_wrapper"><div class='token_number_legend'>1</div><div class="legend_text">Futties Batch 1 (available in Futties 1-3 Pick)</div></div>
    <div class="legend_line_wrapper"><div class='token_number_legend'>2</div><div class="legend_text">Futties Batch 2 (available in Futties 1-3 Pick)</div></div>
    <div class="legend_line_wrapper"><div class='token_number_legend'>3</div><div class="legend_text">Futties Batch 3 (available in Futties 1-3 Pick)</div></div>
    <div class="legend_line_wrapper"><div class='token_number_legend'>4</div><div class="legend_text">Preseason Batch 1 (unavailable)</div> </div>
    <div class="legend_line_wrapper"><div class='token_number_legend'>5</div><div class="legend_text">Preseason Batch 2 (in Packs until FIFA 23)</div> </div>
    <div class="legend_line_wrapper"><div class='token_number_legend'>6</div><div class="legend_text">Campaign Bag Player Pick</div> </div>
  </div>
  <div id="counters">
    <h3>Claimed: <span id="claimed"></span></h3>
    <h3>Expired: <span id="expired"></span></h3>
    <h3>Missed: <span id="missed"></span></h3>
    <h3>Max. possible: <span id="max"></span></h3>
  </div>
  <div class="header">
    <h1>Summer Swaps 2</h1>
    <h2>Token Tracker</h2>
    <div id="attribution">
      <h3 id="docs">?</h3>
    </div>

    <div id="button-wrapper">
      <button class="unclaim btn-standard call-to-action">
        <span class="button__text">Unclaim tokens</span>
      </button>
      <button id="token_reset" class="reset btn-standard call-to-action">
        <span class="button__text">Reset all claimed tokens</span>
      </button>
      <button id="rewards" class="btn-standard call-to-action">
        <span class="button__text">Rewards</span>
      </button>
      <button id="futties" class="btn-standard call-to-action">
        <span class="button__text">Futties Collector</span>
      </button>

    </div>
    <div id="checkbox_wrapper" class="checkbox_wrapper_tokens">
      <div>
        <input type="checkbox" id="sbc" name="sbc" checked>
        <label for="sbc">SBC's</label>
      </div>
      <div>
        <input type="checkbox" id="objectives" name="objectives" checked>
        <label for="objectives">Objectives</label>
      </div>
      <div>
        <input type="checkbox" id="packs" name="packs" checked>
        <label for="packs">Packs</label>
      </div>
    </div>

  </div>
  <div id="tokens"></div>
</body>
<script>

  document.unclaim_mode = false;

  const playerIdentity = window.location.search.substr(1);

  document.futtiescollector = true;

  document.futties_collected = 0;

  document.tokens_expired = 0;

  document.missed = 0;

  let tokens_number = 0;

  $(document).ready(function () {

    $("#legend_wrapper").click(function () {
        $(this).hide();
        localStorage.setItem("legend_hidden", "true");
        $("#show_legend").css("display", "flex");
      });

    $("#show_legend").click(function () {
        $(this).hide();
        localStorage.setItem("legend_hidden", "false");
        $("#legend_wrapper").show();
      });

    $(".reset").click(function () {
      if (document.futtiescollector) {

        if (playerIdentity !== '') {
          localStorage.setItem("document.claimed_futties" + playerIdentity, JSON.stringify([]));
        } else {
          localStorage.setItem("document.claimed_futties", JSON.stringify([]));
        }
      } else {
        if (playerIdentity !== '') {
          localStorage.setItem("document.claimed_tokens" + playerIdentity, JSON.stringify([]));
        } else {
          localStorage.setItem("document.claimed_tokens", JSON.stringify([]));
        }
      }

      location.reload();
    }
    );

    $(".unclaim").click(function () {
      if (document.unclaim_mode == true) {
        document.unclaim_mode = false;
        $(".unclaim").removeClass("mode-active");
      } else {
        document.unclaim_mode = true;
        $(".unclaim").addClass("mode-active");
      }
    }
    );

    $(".print").click(function () {
      $("#tokens").print({ stylesheet: "print.css" });
    }
    );

    $("#rewards").click(function () {
      location.href = "https://i.redd.it/mue2mtnphje91.png";
    }
    );

    $("#docs").click(function () {
      location.href = "https://github.com/freakpants/tokens/blob/main/README.md";
    }
    );
  });

  $("#search").on('input', function (e) {
    let string = $(e.target).val();
    $('.marquee:not(:contains(' + string + '))').closest('.card').hide();
    $('.marquee:contains(' + string + ')').closest('.card.hidden-by-search').show();
    $('.marquee:not(:contains(' + string + '))').closest('.card').addClass("hidden-by-search");
    update_futties_counter();
  });

  function update_token_count() {
    let expired_tokens_done = $(".expired.token-claimed").length;
    $("#claimed").text(document.claimed_tokens.length + "/" + document.available_tokens);
    $("#expired").text(document.tokens_expired);
    $("#missed").text(document.missed - expired_tokens_done);
    $("#max").text(50 - document.missed + expired_tokens_done);
  }

  function update_futties_counter() {
    $("#collected").text($("#tokens .token-claimed.card:visible").length + "/" + $("#tokens .card:visible").length);
    $("#displaying").text($("#tokens .card:visible").length + "/" + 429);
  }

  function fade_in_promo(promo){
    const batch = $("#batch_select").val();
    const selector = get_batch_selector(batch);
    $(".card" + promo + selector).fadeIn(update_futties_counter);
  }

  function display_filters(){
    const batch = $("#batch_select").val();
    // hide all specific filter checkboxes
    $("#checkbox_wrapper input").hide();
    $("#checkbox_wrapper label").hide();
    // show the toggle all
    $("#toggleall").show();
    $("[for=toggleall]").show();
    switch(batch){
      case "preseason_1":
        show_checkbox("shapeshifters");
        show_checkbox("tots");
        show_checkbox("toty");
        show_checkbox("fantasy");
        show_checkbox("libertadores");
      break;
      case "preseason_2": 
        show_checkbox("shapeshifters");
        show_checkbox("tots");
        show_checkbox("toty");
        show_checkbox("fantasy");
        show_checkbox("uefa");
        show_checkbox("captains");
        show_checkbox("birthday");
        show_checkbox("futurestars");
        show_checkbox("wildcard");
      break;
      case "futties_1":
        show_checkbox("toty");
        show_checkbox("fantasy");
        show_checkbox("uefa");
        show_checkbox("birthday");
        show_checkbox("futurestars");
        show_checkbox("wildcard");
        show_checkbox("headliners");
        show_checkbox("signature");
        show_checkbox("totw");
        show_checkbox("numbersup");
        show_checkbox("honourable");
        show_checkbox("halloween");
        show_checkbox("otw");
        show_checkbox("versus");
        show_checkbox("motm");
      break;
      case "futties_2":
        show_checkbox("tots");
        show_checkbox("toty");
        show_checkbox("fantasy");
        show_checkbox("captains");
        show_checkbox("uefa");
        show_checkbox("birthday");
        show_checkbox("futurestars");
        show_checkbox("wildcard");
        show_checkbox("headliners");
        show_checkbox("signature");
        show_checkbox("totw");
        show_checkbox("numbersup");
        show_checkbox("honourable");
        show_checkbox("halloween");
        show_checkbox("otw");
        show_checkbox("versus");
        show_checkbox("motm");
      break;
      case "futties_3":
        show_checkbox("shapeshifters");
        show_checkbox("tots");
        show_checkbox("toty");
        show_checkbox("fantasy");
        show_checkbox("captains");
        show_checkbox("uefa");
        show_checkbox("birthday");
        show_checkbox("futurestars");
        show_checkbox("totw");
        show_checkbox("motm");
      break;
      case "futties_123":
        show_checkbox("shapeshifters");
        show_checkbox("tots");
        show_checkbox("toty");
        show_checkbox("fantasy");
        show_checkbox("captains");
        show_checkbox("uefa");
        show_checkbox("birthday");
        show_checkbox("futurestars");
        show_checkbox("wildcard");
        show_checkbox("headliners");
        show_checkbox("signature");
        show_checkbox("totw");
        show_checkbox("numbersup");
        show_checkbox("honourable");
        show_checkbox("halloween");
        show_checkbox("otw");
        show_checkbox("versus");
        show_checkbox("motm");
        show_checkbox("captains");
        show_checkbox("shapeshifters");
      break;
      case "campaign":
        show_checkbox("fantasy");
        show_checkbox("birthday");
        show_checkbox("wildcard");
      break;
    }
  }

  function show_checkbox(promo){
    $("#" + promo).show();
    $("[for=" + promo + "]").show();
  }

  function mark_tokens() {
    document.claimed_tokens = '';
    document.claimed_futties = '';
    if (document.futtiescollector) {
      if (playerIdentity !== '') {
        document.claimed_futties = localStorage.getItem('document.claimed_futties' + playerIdentity);
      } else {
        document.claimed_futties = localStorage.getItem('document.claimed_futties');
      }

      if (document.claimed_futties == null) {
        document.claimed_futties = [];
      } else {
        document.claimed_futties = JSON.parse(document.claimed_futties);
      }
      document.claimed_futties.forEach(function (token) {
        const parts = token.split('-');
        $('div[data-base-id="' + parts[0] + '"][data-rarity-id="' + parts[1] + '"]').addClass('token-claimed');
      });
      update_futties_counter();

    } else {
      if (playerIdentity !== '') {
        document.claimed_tokens = localStorage.getItem('document.claimed_tokens' + playerIdentity);
      } else {
        document.claimed_tokens = localStorage.getItem('document.claimed_tokens');
      }

      if (document.claimed_tokens == null) {
        document.claimed_tokens = [];
        document.claimed_tokens.push(166847);
      } else {
        document.claimed_tokens = JSON.parse(document.claimed_tokens);
      }

      document.claimed_tokens.forEach(function (token) {
        $('div[data-base-id="' + token + '"]').addClass('token-claimed');
      });

      update_token_count();

    }


  }



  // add data counter to each card
  // $('#tokens > div').each(function(index) {
  //   $(this).attr('data-token-id', index + 1);
  // });

  function get_batch_selector(batch){
    switch(batch){
            case "preseason_1":
              selector = "[data-preseason-1=1]";	
              break;
            case "preseason_2":
              selector = "[data-preseason-2=1]";
            break;
            case "futties_1":
              selector = "[data-futties-1=1]";
            break;
            case "futties_2":
              selector = "[data-futties-2=1]";
            break;
            case "futties_3":
              selector = "[data-futties-3=1]";
            break;
            case "futties_123":
              selector = "[data-futties-1=1],[data-futties-2=1],[data-futties-3=1]";
            break;  
            case "campaign":
              selector = "[data-campaign-bag=1]";
            break;
          }
          return selector;
  }

  function add_darken_class() {
    $('#tokens div').each(function (index) {
      // if this has class token_source, dont darken
      if (!$(this).hasClass('token_source') && !$(this).hasClass('token_objective') && !$(this).hasClass('token_objective_wrapper') && !$(this).hasClass('attributes')) {
        $(this).addClass('darken');
      }
    });
  }

  function card_click(parent) {
    if ($(parent).hasClass('inactive')) {
      return;
    }
    if ($(parent).hasClass('token-claimed')) {
      if (document.unclaim_mode == true) {
        console.log("removing token-claimed class");
        $(parent).removeClass("token-claimed");
        let token_id = $(this).data('base-id');

        if (document.futtiescollector) {
          token_id = $(this).data('base-id') + "-" + $(this).data('rarity-id');
          let index = document.claimed_futties.indexOf(token_id);
          document.claimed_futties.splice(index, 1);
          if (playerIdentity !== '') {
            localStorage.setItem("document.claimed_futties" + playerIdentity, JSON.stringify(document.claimed_futties));
          } else {
            localStorage.setItem("document.claimed_futties", JSON.stringify(document.claimed_futties));
          }
          update_futties_counter();
        } else {
          let index = document.claimed_tokens.indexOf(token_id);
          document.claimed_tokens.splice(index, 1);
          if (playerIdentity !== '') {
            localStorage.setItem("document.claimed_tokens" + playerIdentity, JSON.stringify(document.claimed_tokens));
          } else {
            localStorage.setItem("document.claimed_tokens", JSON.stringify(document.claimed_tokens));
          }
          update_token_count();
        }


        return;
      } else {
        console.log("doing nothing because unclaim mode is false");
        return;
      }
    }

    if (!document.unclaim_mode) {
      $(parent).addClass('token-claimed');

      if (document.futtiescollector) {
        document.claimed_futties.push($(parent).data('base-id') + "-" + $(parent).data('rarity-id'));
        if (playerIdentity !== '') {
          localStorage.setItem("document.claimed_futties" + playerIdentity, JSON.stringify(document.claimed_futties));
        } else {
          localStorage.setItem("document.claimed_futties", JSON.stringify(document.claimed_futties));
        }
        update_futties_counter();
      } else {
        document.claimed_tokens.push($(parent).data('base-id'));
        if (playerIdentity !== '') {
          localStorage.setItem("document.claimed_tokens" + playerIdentity, JSON.stringify(document.claimed_tokens));
        } else {
          localStorage.setItem("document.claimed_tokens", JSON.stringify(document.claimed_tokens));
        }
        update_token_count();
      }
    }

  }



  function name_copy(event) {
    const id = $(event.target).data("base-id");
    var copyTextarea = document.querySelector('[data-type="name"][data-base-id="' + id + '"]');
    console.log(copyTextarea);

    $(copyTextarea).parent().show();

    copyTextarea.type = "text";
    copyTextarea.focus();
    copyTextarea.select();
    document.execCommand("copy");
    $(copyTextarea).parent().hide();
    copyTextarea.type = "hidden";
    event.stopPropagation();
  }

  if (document.futtiescollector) {
    enable_futties();
  } else {
    ajax({
      url: "https://freakpants.github.io/tokens/tokens.json",
    }).done(function (result) {
      console.log(result);
      result.forEach(function (player) {
        $('#tokens').append(player);
        tokens_number++;

      });



      // remember how many tokens are available
      document.available_tokens = tokens_number;
      // generate the rest of the empty divs
      for (let i = tokens_number; i < 50; i++) {
        $('#tokens').append(`
      <div class="card bronze fifa22 inactive" data-base-id="" data-club-id="1929" data-nation-id="14" data-league-id="60" data-rareflag="0">
          <div class="token_number">${i + 1}</div>
          <div class="scard bronze fifa22 style="position: relative; z-index: 2">

              <img src="token.png" alt="" class="player-card">
  
              <div class="rating-gradient"></div>

              
              <div class="avatarholder ">
                  </div>
  
        
              

          </div>
      </div>
      </div>
      `);
      }
      mark_tokens();
      add_darken_class();
      $('#tokens .card.fifa22').click(function () {
        const element = $(this);
        card_click(element);
      });




      $(".marquee").click(function (event) {
        name_copy(event);
      });

      $("#futties").click(function () {
        enable_futties();
      }
      );

      $("#objectives").click(function () {
        if (this.checked) {
          $("[data-type='objective']").closest(".fifa22.card").fadeIn();
        } else {
          $("[data-type='objective']").closest(".fifa22.card").fadeOut();
        }
      });

      $("#sbc").click(function () {
        if (this.checked) {
          $("[data-type='sbc']").closest(".fifa22.card").fadeIn();
        } else {
          $("[data-type='sbc']").closest(".fifa22.card").fadeOut();
        }
      });

      $("#packs").click(function () {
        if (this.checked) {
          $("[data-type='pack']").closest(".fifa22.card").fadeIn();
        } else {
          $("[data-type='pack']").closest(".fifa22.card").fadeOut();
        }
      });

      $(".token_objective_wrapper").each(function (index) {
        const timeStamp = $(this).attr('data-timestamp');
        if (timeStamp == 0) {
          return;
        }
        const timeLeft = timeStamp - (Math.floor(Date.now() / 1000));
        if (timeLeft < 0) {
          document.tokens_expired++;
          document.missed++;
          const closest = $(this).closest(".card.fifa22");
          $(closest).addClass("expired");
          $(closest).find(".token_objective_wrapper").addClass("expired");
          $(closest).find(".token_objective").html("EXPIRED");
          return;
        }
        const timeLeftDays = Math.floor(timeLeft / 86400);
        if (timeLeftDays <= 2) {
          const timeLeftHours = Math.floor(timeLeft / 3600);
          $(this).find(".token_objective").append('<b> (' + timeLeftHours + 'H)</b>');
        }
        if (timeLeftDays == 0) {
          $(this).closest(".card.fifa22").addClass("warning");
        }
      }
      );
      update_token_count();

    });
  }

  function update_batches(trigger) {
    // fade out all
    $(".card.fifa22").fadeOut();
    switch(trigger){
      case "futties_1":
        $(".card.fifa22[data-futties-1='1']").fadeIn(update_futties_counter);
        break;
        case "futties_2":
        $(".card.fifa22[data-futties-2='1']").fadeIn(update_futties_counter);
        break;
        case "futties_3":
        $(".card.fifa22[data-futties-3='1']").fadeIn(update_futties_counter);
        break;
        case "futties_123":
        // fade in all cards that have at least one futties
        $("[data-futties-1='1'],[data-futties-2='1'],[data-futties-3='1']").closest(".card.fifa22").fadeIn(update_futties_counter);
        break;
        case "preseason_1":
        $("[data-preseason-1='1']").closest(".card.fifa22").fadeIn(update_futties_counter);
        break;
        case "preseason_2":
        $("[data-preseason-2='1']").closest(".card.fifa22").fadeIn(update_futties_counter);
        break;
        case "campaign":
        $("[data-campaign-bag='1']").closest(".card.fifa22").fadeIn(update_futties_counter);
        break;
    }
  }

  function enable_futties() {
    document.futtiescollector = true;
    let player_number = 0;
    $("#criminal").hide();
    $("#tokens").html("");
    $("body").addClass("futties");
    $(".header").hide();
    $(".futties-header").show();
    $("#overlay_bg").show();

    // add futties class to token div
    $('#tokens').addClass('futties');
    $.ajax({
      url: "https://freakpants.github.io/collector/players.json",
    }).done(function (result) {
      console.log();
      result.forEach(function (player) {
        $('#tokens').append(player);
        player_number++;


      });
      // bind the click events again
      $(".marquee").click(function (event) {
        name_copy(event);
      });
      $('#tokens .card.fifa22').click(function () {
        const element = $(this);
        card_click(element);
      });

      add_darken_class();

      mark_tokens();

      $("#shapeshifters").click(function () {
        if (this.checked) {
          fade_in_promo(".shapeshifters");
        } else {
          $(".card.shapeshifters").fadeOut(update_futties_counter);
        }

      });

      $("#tots").click(function () {
        if (this.checked) {
          fade_in_promo(".goldblue");
        } else {
          $(".card.goldblue").fadeOut(update_futties_counter);
        }
      });

      $("#toty").click(function () {
        if (this.checked) {
          fade_in_promo("[data-rareflag=5]");
        } else {
          $("[data-rareflag=5]").fadeOut(update_futties_counter);
        }
      });


      $("#fantasy").click(function () {
        if (this.checked) {
          fade_in_promo(".fantasypurple");
          fade_in_promo(".fantasyblue");
        } else {
          $(".card.fantasypurple").fadeOut(update_futties_counter);
          $(".card.fantasyblue").fadeOut(update_futties_counter);
        }
      });

      $("#uefa").click(function () {
        if (this.checked) {
          fade_in_promo(".championsleague");
          fade_in_promo(".elfinal");
          fade_in_promo(".clfinal");
          fade_in_promo(".promo");
          fade_in_promo(".confleague");
        } else {
          $(".card.championsleague").fadeOut(update_futties_counter);
          $(".card.elfinal").fadeOut(update_futties_counter);
          $(".card.clfinal").fadeOut(update_futties_counter);
          $(".card.promo").fadeOut(update_futties_counter);
          $(".card.confleague").fadeOut(update_futties_counter);
        }
      });

      $("#headliners").click(function () {
        if (this.checked) {
          fade_in_promo(".futheadliners");
        } else {
          $(".card.futheadliners").fadeOut(update_futties_counter);
        }
      });

      $("#captains").click(function () {
        if (this.checked) {
          fade_in_promo(".futcaptains");
          fade_in_promo(".futcaptainsheroes");
        } else {
          $(".card.futcaptains").fadeOut(update_futties_counter);
          $(".card.futcaptainsheroes").fadeOut(update_futties_counter);
        }
      });

      $("#birthday").click(function () {
        if (this.checked) {
          fade_in_promo(".birthday");
        } else {
          $(".card.birthday").fadeOut(update_futties_counter);
        }
      });

      $("#otw").click(function () {
        if (this.checked) {
          fade_in_promo(".onestowatch");
        } else {
          $(".card.onestowatch").fadeOut(update_futties_counter);
        }
      });

      $("#wildcard").click(function () {
        if (this.checked) {
          fade_in_promo(".wildcard");
        } else {
          $(".card.wildcard").fadeOut(update_futties_counter);
        }
      });

      $("#signature").click(function () {
        if (this.checked) {
          fade_in_promo(".signature");
        } else {
          $(".card.signature").fadeOut(update_futties_counter);
        }
      });

      $("#numbersup").click(function () {
        if (this.checked) {
          fade_in_promo(".numbersup");
        } else {
          $(".card.numbersup").fadeOut(update_futties_counter);
        }
      });

      $("#halloween").click(function () {
        if (this.checked) {
          fade_in_promo(".halloween");
        } else {
          $(".card.halloween").fadeOut(update_futties_counter);
        }
      });

      // toggle future stars
      $("#futurestars").click(function () {
        if (this.checked) {
          fade_in_promo(".futurestars");
        } else {
          $(".card.futurestars").fadeOut(update_futties_counter);
        }
      });

      // toggle totw
      $("#totw").click(function () {
        if (this.checked) {
          fade_in_promo(".goldif");
        } else {
          $(".card.goldif").fadeOut(update_futties_counter);
        }
      });

      // toggle versus 
      $("#versus").click(function () {
        if (this.checked) {
          fade_in_promo(".versusice");
          fade_in_promo(".versusfire");
        } else {
          $(".card.versusfire").fadeOut(update_futties_counter);
          $(".card.versusice").fadeOut(update_futties_counter);
        }
      });

      // toggle motm
      $("#motm").click(function () {
        if (this.checked) {
          fade_in_promo(".motm");
        } else {
          $(".card.motm").fadeOut(update_futties_counter);
        }
      });

      // toggle toty honourable mentions
      $("#honourable").click(function () {
        if (this.checked) {
          fade_in_promo("[data-rareflag=64]");
        } else {
          $("[data-rareflag=64]").fadeOut(update_futties_counter);
        }
      });

      // toggle libertadores
      $("#libertadores").click(function () {
        if (this.checked) {
          fade_in_promo("[data-rareflag=143]");
        } else {
          $("[data-rareflag=143]").fadeOut(update_futties_counter);
        }
      });


     $("#batch_select").change((e) => {
      const batch = e.target.value;
      update_batches(batch);
      display_filters();
      // check all filter checkboxes
      $(".checkbox_wrapper_futties input").prop("checked", true);
     });

      // toggle all cards
      $("#toggleall").click(function () {
        if (this.checked) {
          const batch = $("#batch_select").val();
          const selector = get_batch_selector(batch);

          $(selector).fadeIn(update_futties_counter);
          $(".checkbox_wrapper_futties input").each(function () {
            $(this).prop("checked", true);
          });

        } else {
          $(".card").fadeOut(update_futties_counter);
          // uncheck all checkboxes in the checkbox_wrapper_futties
          $(".checkbox_wrapper_futties input").each(function () {
            $(this).prop("checked", false);
          });
        }

      });

      // lower case all names
      $(".marquee").each(function () {
        $(this).text($(this).text().toLowerCase());
      });

      $("#togglebatch1").prop("checked", false);
      $("#togglebatch2").prop("checked", false);
      $("#togglebatch3").prop("checked", false);
      // hide all cards
      $(".card").hide();
      // show all cards that are in the current batch
      $("[data-preseason-2]").show();
      display_filters();
      update_futties_counter();

      if(localStorage.getItem("legend_hidden") === null || localStorage.getItem("legend_hidden") === "false") {
        $("#legend_wrapper").css("display", "flex");
      } else {
        $("#show_legend").css("display", "flex");
      }

      // remove the html in all token numbers
      $('.token_number').remove();
      $("[data-futties-1]").append("<div class='token_number'>1</div>");
      $("[data-futties-2]").append("<div class='token_number'>2</div>");
      $("[data-futties-3]").append("<div class='token_number'>3</div>");
      $("[data-preseason-1]").append("<div class='token_number'>4</div>");
      $("[data-preseason-2]").append("<div class='token_number'>5</div>");
      $("[data-campaign-bag]").append("<div class='token_number'>6</div>");
      /* 
        $(this).html("");
        if (typeof $(this).parent().data('futties-1') !== 'undefined') {
          $(this).html("1");
        }
        if (typeof $(this).parent().data('futties-2') !== 'undefined') {
          $(this).append("2");
        }
        if (typeof $(this).parent().data('futties-3') !== 'undefined') {
          $(this).append("3");
        }

      }); */

    });
    $("#counters").hide();
  }

</script>

</html>